// Includes for page layout and individual widgets
include ./layout.pug
include ./mixins.pug

+header("See3D - Donate", "Donate")

// about_start
.popular_catagory_area
  .container
    .row
      .col-lg-12
        .section_title.mb-40
          h3 Financially
    .row
      .col-lg-10
        p.fix-font-20
          | Donations allow us to keep providing 3D models at no price to people who are blind. An average 6 inch model costs about $40 to print and a learning guide costs about $100 to produce. Click below to donate today!
    
    // Giving Tuesday Counter - Integrated
    .row.justify-content-center.mb-5
      .col-lg-10
        .giving-tuesday-box(style='background: linear-gradient(135deg, #02406d 0%, #5db2ff 100%); border-radius: 15px; padding: 35px; box-shadow: 0 10px 30px rgba(2,64,109,0.3); margin: 20px 0; border: 3px solid #7cc8ff;')
          .row.align-items-center
            .col-md-12.text-center.mb-3
              h4(style='color: white; font-weight: bold; font-size: 28px; margin-bottom: 15px; text-transform: uppercase; letter-spacing: 1px;') üéÅ 2025 Giving Tuesday Impact
              p(style='color: rgba(255,255,255,0.95); font-size: 15px; line-height: 1.6; margin-bottom: 20px; max-width: 700px; margin-left: auto; margin-right: auto;')
                | Giving Tuesday (December 2nd) is a global generosity movement that takes place the Tuesday after Thanksgiving. It's a day dedicated to giving back and supporting causes that matter. Your donation helps us provide 3D models to people who are blind at no cost.
            .col-md-6.text-center(style='border-right: 2px solid rgba(255,255,255,0.3);')
              .stat-box(style='padding: 15px;')
                p(style='color: rgba(255,255,255,0.9); font-size: 16px; margin-bottom: 8px; font-weight: 500;') Total Donated
                p#giving-tuesday-total(style='color: white; font-size: 42px; font-weight: bold; margin: 0; text-shadow: 2px 2px 4px rgba(0,0,0,0.3);') -
            .col-md-6.text-center
              .stat-box(style='padding: 15px;')
                p(style='color: rgba(255,255,255,0.9); font-size: 16px; margin-bottom: 8px; font-weight: 500;') Total Donors
                p#giving-tuesday-count(style='color: white; font-size: 42px; font-weight: bold; margin: 0; text-shadow: 2px 2px 4px rgba(0,0,0,0.3);') -
            .col-md-12.text-center.mt-4
              p(style='color: rgba(255,255,255,0.95); font-size: 14px; margin: 0 0 20px 0; font-style: italic;') Donations from any source will be included in this total
              .donation-buttons(style='display: flex; justify-content: center; align-items: center; gap: 20px; flex-wrap: wrap;')
                form(style='display: inline-block;', action='https://www.paypal.com/cgi-bin/webscr', method='post', target='_top')
                  input(type='hidden', name='cmd', value='_s-xclick')
                  input(type='hidden', name='hosted_button_id', value='CFQ4MENHYXSRU')
                  input(type='image', src='img/donate/donate.png', border='0', name='submit', title='PayPal - The safer, easier way to pay online!', alt='Donate with PayPal button', style='height: 140px; transition: transform 0.2s;')
                  img(alt='Donate with paypal', border='0', src='https://www.paypal.com/en_US/i/scr/pixel.gif', width='1', height='1')
                a(href='https://account.venmo.com/u/See3D', style='display: inline-block; background: white; padding: 10px 15px; border-radius: 8px;')
                  img(alt='Donate with Venmo', src='img/donate/venmo.png', height='140px', style='transition: transform 0.2s; display: block;')
    
    .row(style='display: block; text-align: center; margin-top: 30px;')
      a(href='https://www.igive.com/index.cfm/causetoolbox/joinlink')
        img(alt='Show with I Give and donate to see3d', src='img/donate/igive.png', style='max-height: 168px; max-width: 100%; width: auto; height: auto;')
    
    style.
      .donation-buttons img:hover,
      .donation-buttons input[type="image"]:hover {
        transform: scale(1.05);
        cursor: pointer;
      }
      @media (max-width: 768px) {
        .giving-tuesday-box .col-md-6 {
          border-right: none !important;
          border-bottom: 2px solid rgba(255,255,255,0.3);
          padding-bottom: 20px;
          margin-bottom: 20px;
        }
        .giving-tuesday-box .col-md-6:last-of-type {
          border-bottom: none;
          padding-bottom: 0;
          margin-bottom: 0;
        }
      }
    
    script.
      (function(){
        var CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRECscLxIyWSZp9_5iVdfGr32jqBl-7RgFFu3dBtgiEnShyxIsfY3JZv5VriWNoJuQu-ZNsld1MHEMF/pub?gid=0&single=true&output=csv';
        function formatUSD(x){
          try { return x.toLocaleString(undefined,{style:'currency',currency:'USD',maximumFractionDigits:0}); } catch(e){ return '$' + Math.round(x); }
        }
        function cleanAmount(v){
          if(v == null) return NaN;
          var s = String(v).trim().replace(/[^0-9.\-]/g,'');
          return s ? parseFloat(s) : NaN;
        }
        function toInt(v){
          var n = parseInt(String(v).trim(), 10);
          return isNaN(n) ? 0 : n;
        }
        function parseCsvLine(line){
          var result = [];
          var current = '';
          var inQuotes = false;
          for(var i = 0; i < line.length; i++){
            var ch = line[i];
            if(ch === '"'){
              if(inQuotes && i + 1 < line.length && line[i+1] === '"'){
                current += '"';
                i++;
              } else {
                inQuotes = !inQuotes;
              }
            } else if(ch === ',' && !inQuotes){
              result.push(current);
              current = '';
            } else {
              current += ch;
            }
          }
          result.push(current);
          return result;
        }
        function update(total, donors){
          var totalEl = document.getElementById('giving-tuesday-total');
          var donorsEl = document.getElementById('giving-tuesday-count');
          if(totalEl) totalEl.textContent = formatUSD(total);
          if(donorsEl) donorsEl.textContent = String(donors);
        }
        fetch(CSV_URL, { cache: 'no-store' })
          .then(function(res){ return res.text(); })
          .then(function(csv){
            var linesAll = csv.split(/\r?\n/);
            // find first non-empty line as header
            var headerLineIdx = -1;
            for(var i=0;i<linesAll.length;i++){
              if(linesAll[i] && linesAll[i].trim().length){ headerLineIdx = i; break; }
            }
            if(headerLineIdx === -1){ update(0,0); return; }
            var headers = parseCsvLine(linesAll[headerLineIdx]).map(function(h){ return h.trim().toLowerCase(); });
            // find next non-empty data line
            var dataLine = null;
            for(var j=headerLineIdx+1;j<linesAll.length;j++){
              var ln = linesAll[j];
              if(!ln) continue;
              if(ln.trim().length === 0) continue;
              // skip lines that are just commas or quotes
              if(ln.replace(/[",\s]/g,'').length === 0) continue;
              dataLine = ln; break;
            }
            if(!dataLine){ update(0,0); return; }
            var cols = parseCsvLine(dataLine);
            var idxAmount = headers.findIndex(function(h){ return h.indexOf('total money raised') !== -1 || h.indexOf('amount') !== -1; });
            var idxDonations = headers.findIndex(function(h){ return h.indexOf('# of donations') !== -1 || h.indexOf('donations') !== -1; });
            var total = 0;
            var donors = 0;
            if(idxAmount >= 0) total = cleanAmount(cols[idxAmount]);
            if(idxDonations >= 0) donors = toInt(cols[idxDonations]);
            if(!isFinite(total)) total = 0;
            update(total, donors);
          })
          .catch(function(){ update(0,0); });
      })()

    br
    br
    .row
      .col-lg-12
        .section_title.mb-40
          h3 Check Donations
    .row
      .col-lg-10
        p.fix-font-20
          | You can also send a check donation to our mailing address:
        .check-donation-info.mt-3.mb-4
          p.fix-font-20.text-center(style='font-weight: bold; margin-bottom: 10px;') See3D, Inc
          p.fix-font-20.text-center(style='margin-bottom: 5px;') 8772 Arcturus Dr.
          p.fix-font-20.text-center Montgomery, OH 45249
        p.fix-font-20
          | Please make checks payable to "See3D, Inc" and include your contact information if you would like a receipt.

    br
    .row
      .col-lg-12
        .section_title.mb-40
          h3 In-Kind Donations 
    .row
      .col-lg-12
        p.fix-font-20 In-kind donations provide us the materials we need to continue to produce educational 3D models.
    .row
      .col-lg-12
        ul.unordered-list(style='padding-bottom: 13px;')
          li PLA filament in any color
          li Braille writing equipment and clear label stickers
          li 3D printers
          li Tools to clean 3D prints such as foam sanding blocks, tweezers, and heat embossers
          li Cardboard boxes and packaging materials
          li 3D printed models

    .row
      .col-lg-12 
        p.fix-font-20 
          | If you would like to give an in-kind donation, reach out to 
          a(href='mailto:info@see3d.org') info@see3d.org
          |.

    br
    .row
      .col-lg-12
        .section_title.mb-40
          h3 Filament Recycling
      .col-lg-12
        p.fix-font-20 
          | Contact See3D at 
          a(href='mailto:info@see3d.org') info@see3d.org
          |  for a pickup or mail/dropoff
        p.fix-font-20 You can recycle your filament via our collaboration with Printerior! Please mail your scraps of PLA and PETG filament, following the steps below and See3D receives discounts to purchase new filament to make more models for people who are blind or have low vision.
        ul.unordered-list(style='padding-bottom: 13px;')
          li 
            | Or if you are in the Cincinnati or Columbus, Ohio area please email us at 
            a(href='mailto:info@see3d.org') info@see3d.org
            |  for a box pickup.
        a.boxed-btn3.bg-fix(href='recycle_filament') Learn More

+footer()